<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>主页</title>
  <link rel="stylesheet" href="./assets/libs/layuiadmin/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="./assets/libs/layuiadmin/style/admin.css" media="all">
</head>
<script>
  /^http(s*):\/\//.test(location.href) || alert('请先部署到 localhost 下再访问');
</script> 

<body class="layui-layout-body">
  <div id="LAY_app">
  <div class="layui-layout layui-layout-admin">
    <!-- 头部 -->
    <div class="layui-header">
      <!-- 头部区域 -->
      <ul class="layui-nav layui-layout-left">
        <li class="layui-nav-item layadmin-flexible" lay-unselect>
          <a href="javascript:;" layadmin-event="flexible" title="侧边伸缩">
            <i class="layui-icon layui-icon-shrink-right" id="LAY_app_flexible"></i>
          </a>
        </li>
        <li class="layui-nav-item  layui-hide-xs" lay-unselect>
          <!-- 需配置前台登陆入口 -->
          <a href="#" target="_blank" title="前端">
            <i class="layui-icon layui-icon-website"></i>
          </a>
        </li>
        <li class="layui-nav-item" lay-unselect>
          <a href="javascript:;" layadmin-event="refresh" title="刷新">
            <i class="layui-icon layui-icon-refresh-3"></i>
          </a>
        </li>

      </ul>
      <ul class="layui-nav layui-layout-right" lay-filter="layadmin-layout-right">

        <li class="layui-nav-item" lay-unselect>
          <a lay-href="app/message/index.html" layadmin-event="message" lay-text="消息中心">
            <i class="layui-icon layui-icon-notice"></i>

            <!-- 如果有新消息，则显示小圆点 -->
            <span class="layui-badge-dot"></span>
          </a>
        </li>


        <li class="layui-nav-item layui-hide-xs" lay-unselect>
          <a href="javascript:;" layadmin-event="fullscreen">
            <i class="layui-icon layui-icon-screen-full"></i>
          </a>
        </li>
        <li class="layui-nav-item" lay-unselect>
          <a href="javascript:;">
            <cite><script id="demo" type="text/html">{{d.name}}</script></cite>
          </a>
          <dl class="layui-nav-child">
            <dd><a lay-href="set/user/info.html">基本资料</a></dd>
            <dd><a lay-href="set/user/password.html">修改密码</a></dd>
            <hr>
            <dd layadmin-event="logout" style="text-align: center;"><a>退出</a></dd>
          </dl>
        </li>


        <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-unselect>
          <a href="javascript:;" layadmin-event="more"><i class="layui-icon layui-icon-more-vertical"></i></a>
        </li>
      </ul>
    </div>
    <!-- 侧边菜单 -->
    <div class="layui-side layui-bg-blue layui-side-menu">
      <div class="layui-side-scroll">
        <div class="layui-logo" lay-href="home/console.html">
          <span>博客管理</span>
        </div>

        <ul class="layui-nav layui-nav-tree" lay-shrink="all" id="LAY-system-side-menu"
          lay-filter="layadmin-system-side-menu">
          <li data-name="home" class="layui-nav-item layui-nav-itemed">
            <a href="javascript:;" lay-tips="文章管理" lay-direction="2">
              <i class="layui-icon layui-icon-home"></i>
              <cite>文章管理</cite>
            </a>
            <dl class="layui-nav-child">
              <dd data-name="console" class="layui-this">
                <a lay-href="meetManage/meetList.html">文章管理</a>
              </dd>
              <dd data-name="console">
                <a lay-href="typeManage/index.html">文章类型管理</a>
              </dd>
              <dd data-name="console" class="layui-this">
                <a lay-href="meetManage/index.html">博客管理</a>
              </dd>
              <dd data-name="console">
                <a lay-href="search/index.html">文章搜索</a>
              </dd>
            </dl>
          </li>
          <li data-name="component" class="layui-nav-item">
            <a href="javascript:;" lay-tips="组件" lay-direction="2">
              <i class="layui-icon layui-icon-component"></i>
              <cite>用户管理</cite>
            </a>
            <dl class="layui-nav-child">
              <dd data-name="console" class="layui-this">
                <a lay-href="userManage/index.html">人员管理</a>
              </dd>
              <dd data-name="console" >
                <a lay-href="userManage/role.html">角色管理</a>
              </dd>
              <dd data-name="console" >
                <a lay-href="treeselect/index.html">管理</a>
              </dd>
            </dl>
          </li>

        </ul>
      </div>
    </div>

    <!-- 页面标签 -->
    <div class="layadmin-pagetabs" id="LAY_app_tabs">
      <div class="layui-icon layadmin-tabs-control layui-icon-prev" layadmin-event="leftPage"></div>
      <div class="layui-icon layadmin-tabs-control layui-icon-next" layadmin-event="rightPage"></div>
      <div class="layui-icon layadmin-tabs-control layui-icon-down">
        <ul class="layui-nav layadmin-tabs-select" lay-filter="layadmin-pagetabs-nav">
          <li class="layui-nav-item" lay-unselect>
            <a href="javascript:;"></a>
            <dl class="layui-nav-child layui-anim-fadein">
              <dd layadmin-event="closeThisTabs"><a href="javascript:;">关闭当前标签页</a></dd>
              <dd layadmin-event="closeOtherTabs"><a href="javascript:;">关闭其它标签页</a></dd>
              <dd layadmin-event="closeAllTabs"><a href="javascript:;">关闭全部标签页</a></dd>
            </dl>
          </li>
        </ul>
      </div>
      <div class="layui-tab" lay-unauto lay-allowClose="true" lay-filter="layadmin-layout-tabs">
        <ul class="layui-tab-title" id="LAY_app_tabsheader">
          <li lay-id="home/console.html" lay-attr="home/console.html" class="layui-this"><i
              class="layui-icon layui-icon-home"></i></li>
        </ul>
      </div>
    </div>

    <!-- 主体内容 -->
    <div class="layui-body" id="LAY_app_body">
      <div class="layadmin-tabsbody-item layui-show">
        <iframe src="home/index.html" frameborder="0" class="layadmin-iframe"></iframe>
      </div>
    </div>

    <!-- 辅助元素，一般用于移动设备下遮罩 -->
    <div class="layadmin-body-shade" layadmin-event="shade"></div>
  </div>
  </div>

  <script src="./assets/libs/layuiadmin/layui/layui.js"></script>
  <script>
    layui.config({
      base: './assets/libs/layuiadmin/' //静态资源所在路径
    }).extend({
      index: 'lib/index' //主入口模块
    }).use('index','setter', function () {
      var $ = layui.$
        , setter = layui.setter
        , laytpl = layui.laytpl;
      // window.data=userinfo;
      // window.data = {
      //   "id": 1, "user_name": "张三", "user_age": 18, "user_phone": "12345678910"
      //   , "user_qq": "12312313", "user_email": "12312313@qq.com", "user_address": "", "user_mark": 0, "user_image_url": "", "token": ""
      // };
      //第三步：渲染模版
      //  console.log(layui.sessionData('layuiAdmin').data[0]['token'])

      $(document).ready(function () {
        // 如果会话性存储 数据为空，返回登录界面
        if (layui.sessionData(setter.tableName) === {}) {
          location.href = '/login/index.html'; //登录主页
        } else {
          // 如果会话性存储data键为空
          if (layui.sessionData(setter.tableName).data != null) {
            // 如果会话性存储data键第一个键token为空
            if (layui.sessionData(setter.tableName).data[0]['token'] === '') {
              // 返回到登录界面
              location.href = '/login/index.html'; //登录主页
            }
          }
          // 返回登录界面
          else {
            location.href = '/login/index.html'; //登录主页
          }
        }
      });


      var lastTime = new Date().getTime();
      var currentTime = new Date().getTime();
      // var timeOut = 30 * 60 * 1000; //设置超时时间： 30分
      var timeOut = 15 * 60 * 1000; //设置超时时间： 15分

      // window.onload = function () {
      //   window.document.onmousedown = function () {
      //     localStorage.setItem("lastTime", lastTime);//new Date().getTime());
      //   }
      // };

      function checkTimeout() {
        currentTime = new Date().getTime(); //更新当前时间
        // lastTime = localStorage.getItem("lastTime");
        // console.log(currentTime);
        // console.log(lastTime);
        // console.log(currentTime - lastTime);
        // console.log(timeOut);
        if (currentTime - lastTime > timeOut) { //判断是否超时
          console.log("超时");
          location.href = '/login/index.html'; //登录页面
        }
      }

      /* 定时器 间隔30秒检测是否长时间未操作页面 */
      window.setInterval(checkTimeout, 1000 * 30);

      var data2 = { //数据
        "name": layui.sessionData(setter.tableName).data[1]["user"].user_name
      }
      var getTpl = demo.innerHTML
        , view = document.getElementById('view');
      laytpl(getTpl).render(data2, function (html) {
        view.innerHTML = html;
      });
    });
    </script>
  </body>
  
  </html>